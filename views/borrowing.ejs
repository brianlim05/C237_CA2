<!-- views/borrowing.ejs -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Borrow Items</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <%- include('share/navbar', { active: 'borrowing' }) %>

  <div class="container mt-4">
    <% if (errors && errors.length > 0) { %>
      <div class="alert alert-danger">
        <% errors.forEach(msg => { %>
          <p><%= msg %></p>
        <% }) %>
      </div>
    <% } %>

    <% if (success && success.length > 0) { %>
      <div class="alert alert-success">
        <% success.forEach(msg => { %>
          <p><%= msg %></p>
        <% }) %>
      </div>
    <% } %>

    <h2 class="mb-4 text-center">Borrowable Items</h2>

    <% if (items.length === 0) { %>
      <div class="alert alert-info text-center">No items available to borrow right now.</div>
    <% } else { %>
      <table class="table table-bordered text-center">
        <thead class="table-light">
          <tr>
            <th>Image</th>
            <th>Name</th>
            <th>Available</th>
            <th>Price</th>
            <th>Borrow</th>
          </tr>
        </thead>
        <tbody>
          <% items.forEach(item => { %>
            <tr>
              <td>
                <img src="/images/<%= item.image %>" width="80" onerror="this.src='/images/placeholder.png'" />
              </td>
              <td>
                <a href="/item/<%= item.itemId %>"><%= item.itemName %></a>
              </td>
              <td><%= item.quantity %></td>
              <td>$<%= item.price.toFixed(2) %></td>
              <td>
                <form method="POST" action="/add-to-list/<%= item.itemId %>">
                  <div class="input-group">
                    <select name="quantity" class="form-select" required>
                      <% for (let q = 1; q <= Math.min(5, item.quantity); q++) { %>
                        <option value="<%= q %>"><%= q %></option>
                      <% } %>
                    </select>
                    <button type="submit" class="btn btn-primary">Borrow</button>
                  </div>
                </form>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    <% } %>
  </div>
</body>
</html>
